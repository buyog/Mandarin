; States file for Mandarin -- Specials
;
;---------------------------------------------------------------------------
; Vars:
;   0: for Super Jump (0=vertical, 1=forward, -1=backward)
; Helpers:
;   0: superjump opponent position indicator
; Explods:
;---------------------------------------------------------------------------

;---------------------------------------------------------------------------
; Special Attacks
; 
; Freezing Ray (D, DF, F + P) - states 1000 - 1010
;---------------------------------------------------------------------------

;------------------------
; Freezing Ray
;------------------------------
; Special 1
[StateDef 1000]
type = S
movetype = A
physics = S
anim = 1000
ctrl = 0
velset = 0,0

; voice
[State 1000, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 1
value = S9,0
channel = 0

; sfx
[State 1000, PlaySnd]
type = PlaySnd
trigger1 = AnimElem = 1
value = S9,1

[State 1000, beam]
type = Helper
trigger1 = AnimElem = 1
helpertype = normal
name = "beam"
ID = 1010
pos = 65,-75
postype = p1
stateno = 1010
ownpal = 1

[State 1000, changestate]
type = ChangeState
trigger1 = AnimTime = 0 & NumHelper(1010) = 0
value = 1020

[State 1000, changestate]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;--------
; Special 1 -- beam helper state
[StateDef 1010]
type = A
movetype = A
physics = C
anim = 1010
ctrl = 0

[State 1010, ontop]
type = SprPriority
trigger1 = 1
value = 2

[State 1010, PosSet]
type = PosSet
trigger1 = 1
x = parent, Pos X + (65 * parent, facing)
y = parent, Pos Y - 75

[State 1010, PlaySnd]
type = PlaySnd
trigger1 = Time = 0
value = S9,1

[State 1010, hitdef]
type = HitDef
trigger1 = Time = 0
attr = S,SA
hitflag = MAF
guardflag = MA
animtype = Medium
air.animtype = Medium
fall.animtype = Medium
damage = 40,5
guardflag = MA
pausetime = 6,12
hitsound = S9,1
guardsound = S3,0
sparkno = S9992
animtype = Heavy
p2stateno = 1050
ground.type = High
ground.slidetime = 10
ground.hittime  = 20
ground.velocity = -8
guard.velocity = -5
air.velocity = -4,8
kill = 1
guard.kill = 1
fall.kill = 1
palfx.time = 25
palfx.add = 64,0,0

[State 1010, DestroySelf]
type = DestroySelf
trigger1 = !AnimTime
trigger2 = parent, Anim != 1000


;---------
; Freezing Ray - end
[StateDef 1020]
type = S
movetype = A
physics = S
anim = 1020

[State 1020, changestate]
type = ChangeState
trigger1 = !AnimTime
value = 0
ctrl = 1


;---------
; Freezing Ray - p2 custom frozen state, air/ground anim determiner
;  Frozen: anim 7990
;  Frozen in midair: anim 7991
[StateDef 1050]
type    = U
MoveType = H
physics = U
ctrl = 0
VelSet = 0,0

[State 1050, PalFXWiz] ;Generated by MEE PalFX Editor
type = PalFX
;triggerall = prevstateno != [1050,1060]
trigger1 = (time = 0) && (!AnimExist(7990))
time = 60
add = 0,64,128
mul = 512,512,512
sinadd = 0,0,0,1
invertall = 0
color = 256

[State 1050, drain power]
type = PowerAdd
trigger1 = Time = 0
value = -75

[State 1050, falling (if frozen in air)]
type = ChangeState
trigger1 = pos y < 0
value = 1055

[State 1050, KOed by iceball]
type = ChangeState
trigger1 = life <= 0
value = 5050    ;1057

[State 1050, ground freeze, has anim]
type = ChangeAnim
triggerall = SelfAnimExist(7990)
trigger1 = (time = 0) && (pos y >= 0)       ; StateType != A
value = 7990

[State 1050, ground freeze, no anim]
type = ChangeAnim2
triggerall = !SelfAnimExist(7990)
trigger1 = (time = 0) && (pos y >= 0)
ctrl = 0
value = 1050

[State 1050, back to normal]
type = ChangeState
trigger1 = time = 60
;trigger2 = prevstateno != [1050,1060]
value = 1060
ctrl = 1

; Iceball: P2 custom falling state (if frozen in air)
[StateDef 1055]
type    = A
MoveType = H
physics = N
ctrl = 0
VelSet = 0,0

[State 1055, 0]
type = VelSet
trigger1 = time = 10
x = -3
y = 2

[State 1055, 1]
type = VelSet
trigger1 = time = 20
x = -3
y = 5

[State 1055, air freeze, has anim]
type = ChangeAnim
trigger1 = (time = 0) && (AnimExist(7991))
value = 7991

[State 1055, air freeze, no anim]
type = ChangeAnim2
trigger1 = (time = 0) && (!AnimExist(7991))
ctrl = 0
value = 1051

[State 1055, ice shatters when hit ground]
type = ChangeState
trigger1 = (pos y >= 10)
value = 1060


; Iceball: P2 custom falling state (if KO'ed by the ball)
[StateDef 1057]
type    = A
MoveType = H
physics = A
ctrl = 0
VelSet = -4,-3

[State 1057, air freeze, has anim]
type = ChangeAnim
trigger1 = (time = 0) && (AnimExist(7991))
value = 7991

[State 1057, air freeze, no anim]
type = ChangeAnim2
trigger1 = (time = 0) && (!AnimExist(7991))
ctrl = 0
value = 1051


; P2 custom state: coming "unfrozen"
[StateDef 1060]
type    = U
MoveType = H
physics = U
ctrl = 0
VelSet = 0,0
sprpriority = 0

[State 1060, PosSet]
type = PosSet
trigger1 = time = 0
y = 0

[State 1060, flat on yer back]
type = SelfState
trigger1 = (time = 5) && (PrevStateNo = 1055)
value = 5100    ;0

[State 1060, back to standing]
type = SelfState
trigger1 = (time = 5) && (PrevStateNo != 1055)
value = 0
ctrl = 1


; p1 after-iceball transition state
[StateDef 1061]
type    = S
MoveType = I
physics = U
anim = 0
ctrl = 0
sprpriority = 2

[State 1061, ice shards]
type = Helper
trigger1 = time = 0
;helpertype = normal
name = "ice effects"
;ID = 0
pos = 0,0
postype = p2
bindtime = 100
;facing = 1
StateNo = 1062
keyctrl = 0
ownpal = 1

[State 1061, back to normal]
type = ChangeState
trigger1 = time = 1
value = 0
ctrl = 1

; helper state for iceball cocoon (invisible if P2 has their own custom freeze anims)
[StateDef 1062]
type    = S
MoveType = I
physics = U
ctrl = 0
VelSet = 0,0
sprpriority = 2

[State 1062, follow P2]
type = PosAdd
trigger1 = AnimTime < 0
x = P2Dist X
y = P2Dist Y

[State 1062, changeanim1]
type = ChangeAnim
trigger1 = (P2StateNo = 1050)
value = ifelse(enemy, AnimExist(7990),1061,1060)

[State 1062, changeanim2]
type = ChangeAnim
trigger1 = (P2StateNo = 1055)
value = ifelse(enemy, AnimExist(7991),1063,1062)

[State 1062, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
trigger2 = (P2StateNo != [1050,1055])
value = 1065


; helper state for shattering ice cocoon
[StateDef 1065]
type    = S
MoveType = I
physics = U
anim = 1069
ctrl = 0
VelSet = 0,0
sprpriority = 2

[State 1065, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = 9,1

[State 1065, DestroySelf]
type = DestroySelf
trigger1 = AnimTime = 0
